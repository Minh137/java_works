package webChat;

import java.io.BufferedWriter;
import java.io.FileOutputStream;
import java.io.FileWriter;
import java.io.IOException;
import java.io.OutputStreamWriter;

import javax.servlet.ServletContext;
import javax.servlet.ServletException;
import javax.servlet.annotation.WebServlet;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;


@WebServlet("/write")
public class chatWriteServel extends HttpServlet {
	
	private String filePath;
	


	protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		
		//서블릿콘텍스트를 이용해 파일의 절대 경로를 얻어온다.
		ServletContext context = getServletContext();
		filePath = context.getRealPath("/chat/message.txt");
		request.setCharacterEncoding("utf-8");
		//사용자이름, 메시지, first
		String username = request.getParameter("username");
		String first = request.getParameter("first");
		String message = request.getParameter("message");
		if(first != null && message != null ) {
			message = username +"님이 입장하셨어요~";
		}else if(
				username != null &&
				message != null &&
				!message.trim().isEmpty()) {
			message = "["+username+"] " + message;
			
		       try(BufferedWriter writer = new BufferedWriter(new OutputStreamWriter(new FileOutputStream(filePath), "UTF-8"))){
		            writer.write(message);
		            writer.newLine();
		        )catch(IOException e) {
		           e.printStackTrace();
		        }
		}
		
	}


	protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
		// TODO Auto-generated method stub
		doGet(request, response);
	}

}
